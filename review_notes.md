# MVPコードレビュー（中立）

## 実行結果
- `pytest -q` は、依存関係（Django未導入）によりテスト収集時点で失敗。
- `pip install -r requirements/dev.txt` は、プロキシ制約（403）により依存解決に失敗。

## 指摘事項

### 1. 再出題制御の永続性要件と矛盾する可能性（重要）
`submit_phase1` で `UserSeenQuestion` を `SOLVED` に更新しているため、4択問題でフェーズ2を未回答のまま離脱しても「解いた扱い」になります。要件上は「解いた（solved）問題は再出題しない」なので、仕様意図次第では問題ありませんが、「フェーズ2まで完了して solved」としたい場合は更新タイミングの見直しが必要です。

### 2. 問題整合性のDBレベル担保が弱い（重要）
`Question.choice_count` や `Option.author_type/llm_model` の整合性は `clean()` で検証されていますが、アプリ層を介さない保存では `clean()` が走らないため不正データ混入余地があります。運用上の安全性を高めるには DB 制約の追加（CheckConstraint など）を推奨します。

### 3. ランキングの並び順が正答率基準ではない（改善）
フェーズ1ランキングは `-correct, -total` でソートされるため、正答率が高くても試行数が少ないユーザーが下位になる可能性があります。要件に「正答率重視」があるなら、表示指標とソートキーの一貫性を明示した方がよいです。

## 良かった点
- フェーズ1/フェーズ2の責務分離が明確で、サービス層にロジックが寄せられており見通しが良い。
- 4択フェーズ2で重複割当禁止やグループ整合性検証が実装され、MVPとして十分なガードがある。
